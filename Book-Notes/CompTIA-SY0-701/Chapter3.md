<< [Back to the main page](README.md) 
<br>
<br>
< [Go to Chapter 2: Cybersecurity Threat Lanscape](Chapter2.md)
<br>
Go to Chapter 4: >
----------------------------------------------

# Table of Content
- [Exercise](#exercise)
- [Malware](#malware)
    - [Ransomware](#ransomware)
        - [Indicator of Compromise](#indicator-of-compromise-ransomware)
        - [Effective Solution](#effective-solution-ransomware)
    
    - [Trojans](#trojans)
        - [Remote Access Trojans (RATs)](#remote-access-trojans-rats)

    - [Command and Control (C&C)](#command-and-control-cc)
    - [Botnets](#botnets)
        - [Indicator of Compromise](#indicator-of-compromise-botnets)

    - [Worms](#worms)
    - [Spyware](#spyware)
        - [Keyloggers](#keyloggers)

    - [Bloatware](#bloatware)
    - [Viruses](#viruses)
        - [Fileless Malware](#fileless-malware)
        - [Boot Sector Virus](#boot-sector-virus)
        - [Macro Virus](#macro-virus)
        - [Shell Virus](#shell-virus)

    - [Logic Bombs](#logic-bombs)
        - [Time Bombs](#time-bombs)

    - [Rootkits](#rootkits)
        - [Effective Solution](#effective-solution-rootkits)

    - [Adware](#adware)
    - [Cryptojacking](#cryptojacking)
    - [Backdoors](#backdoors)
    - [Polymorphic Malware](#polymorphic-malware)
    - [Potentially Unwanted Program (PUP)](#potentially-unwanted-program-pup)
    - [Computer Hoax](#computer-hoax)

- [Analyzing Malware](#analyzing-malware)
    - [Static Analyze](#static-analyze)
        - [Open source tools for static analysis](#open-source-tools-for-static-analysis)
        - [Open source tools for reverse engineering](#open-soruce-tools-for-reverse-engineering)

    - [Dynamic Analyze](#dynamic-analyze)
        - [Open source tools for dynamic analysis](#open-source-tools-for-dynamic-analysis)

- [Malware Solution](#malware-solution)
    - [Antivirus](#antivirus)
    - [Endpoint Detection and Response (EDR)](#endpoint-detection-and-response-edr)
   
# Exercise
[Back to Table of Content](#table-of-content)

# Malware
- Malware = Malicious Software
- Program that can harm your system
- One malware can be in one or more categories

[Back to Table of Content](#table-of-content)

## Ransomware
- Take over a system or resources (such as files) and then demands a ransom
- Can be [`trojan`](#trojans) - Looking good to user but later demands for ransom
- May `steal files` and demands a ransom
- May `encrypt files` and demands a ransom
- May steal files, threathening to `distribute user's sensitive resources` (extortion or blackmail) and demands a random
- Ransom usually be paid in cryptocurrency (e.g. Bitcoin) so that it will be harder to track the money recipient
- Example of Ransomware
    - BitPaymer
    - Cryptolocker
    - Petya
    - WannaCry (use SMB vulnerability - EternalBlue)
    - REvil
    - NotPetya
    - NetWalker

[Back to Table of Content](#table-of-content)

### Indicator of Compromise Ransomware
- Pirated Software
- High CPU and memory consumption (use for file encryption)
- Connect to suspicious IP address (try to contact the hacker for encryption key distribution)
    - Known as `Command and Control`
    - Hacker can command and control the ransomware or system via remote connection

- File extension start to changed
- File name start to changed
- Cannot open some files that should be easily to be openned

[Back to Table of Content](#table-of-content)

### Effective Solution Ransomware
- Backup files
- Avoid pirated software
- Better malware defender solution or `anti-ransomware tools`
- Capture the content of memory and forensics for `decryption keys`
- Useless against `extortion ransomware` that still threathening confidentiality.

[Back to Table of Content](#table-of-content)

## Trojans
- Malware that disguised as legitimate software (like Trojan Horse in Greek mythology)
- Can be signed or trusted software downloading from app store but secretly perform malicious tasks
- Malicious browser extension or add-ons
- Example of Trojans
    - TrickBot
    - FakeAV
    - Triada Trojan (disguised as WhatsApp)

[Back to Table of Content](#table-of-content)

### Remote Access Trojans (RATs)
- Type of trojan that enable hacker able to `remotely access to the system`
- Some of remote access tools can be used as RATs
- Sometimes Antimalware can falsely detect trojans on remote access tools
- Can be considered as [`Backdoors`](#backdoors) because it enable hacker to be able to [`command and control`](#command-and-control-cc) to the system
- Example of legitimate remote access tools
    - Teamviewer
    - AnyDesk

[Back to Table of Content](#table-of-content)

## Command and Control (C&C)
- Sometimes known as `C2`
- Remotely command and control the program or system.
- Can be a sign of [`backdoor`](#backdoors)
- Protocol used to command and control to the target can be varied
    - HTTP, HTTPS
    - IRC (Internet Relay Chat) via port 6667
    - DNS tunelling (communicate via DNS protocol)
    - Ping (communicate via ICMP protocol)
    - Others or custom protocol

- If unknown port is openned, it can be used by command and control
- Hacker may encrypted the communication so that it will be harder for network intrusion detection

- Ransomware
    - Hacker generate encryption key and send to the ransomware
    - Hacker may command ransomware to send file backs
    - Hacker may command ransomware to encrypt file
    - Hacker may control the ransomware so that user cannot directly remove it

- Remote Access Trojan
    - It open `command and control` features for hacker
    - Hacker will be now able to command and control your system

- Botnets
    - Command can be simple or complex (custom powershell, cmd, or bash)
    - Hacker may command the infected system to perform DOS to the specified target.
    - Hacker may command thousands of infected system to perform DDoS to the specified target.

[Back to Table of Content](#table-of-content)

## Botnets
- Bot = infected system that is ready for command and control from hacker
- Botnets = group of bots (may thousands or millions of them)
- `Infected systems` act as `army` for hacker
- Commonly used to perform Distributed Denial of Service (DDoS).
    - Generate thousands or millions of requests from botnets
    - Can takedown the blockchain network if big enough (Electrum Bitcoin Wallet Incident)
    - Can takedown company systems due to the number

- Millions of systems (botnets) may help hacker to mine cryptocurrency - [Cryptojacking](#cryptojacking)
- Everyone can be a part of botnets without realization

[Back to Table of Content](#table-of-content)

### Indicator of Compromise Botnets
- Specific program consume resources suspiciously
- Suspicious connection
- Suspicious request send to unknown or unintent destination
- Connect to the target that is reported as a DDoS target from [threat intelligence](Chapter2.md/#threat-intelligence)
- Connect to cryptocurrency mine address
- Bulk request generated from the system
- Suspicious of protocol usage (Sending too much DNS)

[Back to Table of Content](#table-of-content)

## Worms
- Can spread, work, and duplicate by itself without user interaction
- Common attack vector for worms
    - Email attachment
    - Network file shares
    - Vulnerable Devices like IoT
    - Phones

- Commonly spread in network layer
- Example of Worms
    - Stuxnet - aimed Iranian Nuclear Program
    - Raspberry Robin - part of pre-ransomware activity
    - Morris worm
    - Creeper Virus

[Back to Table of Content](#table-of-content)

## Spyware
- Software + Spy
- Spy the system activities
- Steal user files or resources
- Track user activities, habits, and report back to the hacker
- Associate with identity theft and fraud, advertising, ilicitly monitor partners in relationships
- Can be form of [`Trojan`](#trojans) - looking good to user but secretly be spy

[Back to Table of Content](#table-of-content)

### Keyloggers
- Type of Spyware
- Spy for keyboards typing activities (Can get user password)
- Spy for mouse clicking activities

[Back to Table of Content](#table-of-content)

## Bloatware
- Software that comes preinstalled on a computer, tablet, or phone
- Microsoft Edge that always come after Windows installation
- Hand off the laptop to `repair technician` for `new OS installation`
    - They provides additional software that is not default on OS
    - They may provide Games that is not default in OS
    - They may provides `Trojan` or `Malware` that is not default on OS
    - Malicious technician may includes [`Backdoor`](#backdoors)
    - They may provides [`Potentially Unwanted Program`](#potentially-unwanted-program) - `MCafee` in Windows (That already has Windows Defender at default)

[Back to Table of Content](#table-of-content)

## Viruses
- Can replicated itself like `worm` but requires `user interaction`
- Virus need hosts
    - Email
    - Program
    - Process
    - USB devices
    
- Virus is `subset of malware`. - Many people call every malicious program as virus
- Virus will have `condition` to `trigger` their actions
    - USB stick is attached
    - Some system flaws is found
    - Some process is spawned
    - After reboot, After turn on

- Virus that has their body or file in harddisk known as `non-memory-resident virus`

[Back to Table of Content](#table-of-content)

### Fileless Malware
- Known as `memory-resident viruses`
- Virus that store itself in memory and work in memory directly
- Hard for detection because it `do not has their body in harddisk`
- Behavioral detection is effective

[Back to Table of Content](#table-of-content)

### Boot Sector Virus
- Virus that reside in the boot sector of storage media
- Very hard to detect and remove
- OS reinstallation can be useless
- Effective solution is to format the harddisk or buying a new one

[Back to Table of Content](#table-of-content)

### Macro Virus
- Virus that reside in `macros code`
- The common program that used macros code
    - Microsoft Words
    - Microsoft Excel
    - Word Processing Software

- Macros is now disabled by default in Windows
- Macros is not always bad - commonly used in financial reports

[Back to Table of Content](#table-of-content)

### Shell Virus
- Sometimes hacker try to upload of inject some files to the system
- When hacker trigger that files
    - Access via http
    - Access via target php websites
    - Execute the file
    - User execute the file

- It can spawn terminal or shell to the hacker to be able to `command and control`.
- Website offer file uploading (profile image uploading)
- Hacker upload shellcode instead of image
- User access the profile image (shellcode)
- Hacker gain shell or terminal `command and control`
    - Bind shell - Target open port for shell communication (easily to be blocked by firewall)
    - Reverse Shell - Hacker open port for shell communication (bypass firewall)

[Back to Table of Content](#table-of-content)

## Logic Bombs
- Require condition to be executed like [virus](#viruses)
- Condition can be complex rather than user clicking
    - When a specific value in database is deleted
    - When a specific system configuration is changed
    - when a specific file is removed
    - When a specific employee is fired
    - When 100 people open the laptops

- Activate when a set conditions are met - simple or complex

[Back to Table of Content](#table-of-content)

### Time Bombs
- Logic bombs that conditioned by time

[Back to Table of Content](#table-of-content)

## Rootkits
- Very hard to detect and Remove
    - Hooking filesystem drivers (remove driver = crash)
    - Startup code in Master Boot Record (MBR)
    - It invades Operating System

- Specifically enable hacker to gain access to the system remotely ([Backdoor](#backdoors))
- Can use for privilege escalation (Rootkits = kit for rooting)
- Rootkits can bypass all protection
- Rootkits can be intentionaly installed
    - Anti-cheating toolkits for games

[Back to Table of Content](#table-of-content)

### Effective Solution Rootkits
- Integrity Checking
- Data Validation against responses
- Anti-rootkit tools
- Tamper protection

[Back to Table of Content](#table-of-content)

## Adware
- Advertistment + Malware = Adware
- Malware that embedded advertistment to the user
- Make unwanted or spam advertistment to ther user
- Change default search engine on browser
- Consume system resource

[Back to Table of Content](#table-of-content)

## Cryptojacking
- Malware that used system resource to mine cryptocurrency for hacker
- Consume resource for mining
- Can be part of [botnets](#botnets) and [command and control](#command-and-control-cc)
- Can also be [trojans](#trojans) - Looking good to user but secretly mine cryptocurrency

[Back to Table of Content](#table-of-content)

## Backdoors
- Frontdoor = normal entry (Authentication is common)
- Backdoor = unusual entry (Authentication is bypassed)
- Software that enable secret access to the system for hacker
- Software that enable someone to bypass all authentication system
- Developer add backdoors to the program so that they can easily access and maintain later
    - For customer support
    - For malicious purpose, secretly access customer data

- Admin may add backdoors to the employee computers
    - They can monitor and control the company laptop usage
    - They can access and remidiate any issue raised by the employees
    - They may secretly access employee personal data

- [Command and Control](#command-and-control-cc) can be sign of backdoor
- Not all backdoors are bad

[Back to Table of Content](#table-of-content)

## Polymorphic Malware
- Malware that can change their signature to avoid detection
- Bytecode pattern change
- Hash change
- Behavior change
- Same malware but different signature

[Back to Table of Content](#table-of-content)

## Potentially Unwanted Program (PUP)
- Not a malware
- Unwanted program for the user installed by accident
    - Installed by technician
    - Packed with other program (Opera Browser, MCafee)
    - Download program A but also get Opera Browser to be installed

- Consume system resources

[Back to Table of Content](#table-of-content)

## Computer Hoax
- Not a malware
- Tricked notification to tell the user that their system is compromised
- Lying to user that their system is compromised
- Threatening user that their system is compromised and required remidiation (which is not)
- Commonly found in malware alert in website

[Back to Table of Content](#table-of-content)

# Analyzing Malware

[Back to Table of Content](#table-of-content)

## Static Analyze
- Examine malware `without execute it`
- Bytecode inspection
- Metadata inspection
- Signature inspection
- Source-code inspection
- Reverse-engineering (turn bytecode into source-code and then analyze)
- Most easy and fast

[Back to Table of Content](#table-of-content)

### Open source tools for static analysis
- VirusTotal
- MalwareBazaar
- YARA
- PEiD

[Back to Table of Content](#table-of-content)

### Open soruce tools for reverse engineering
- IDA Free
- Ghidra
- Apktool
- Binary Ninja
- REMnux

[Back to Table of Content](#table-of-content)

## Dynamic Analyze
- Examine malware by `execute it`
- Execute in safe enviroment rather than real enviroment.
- Execute in `sandbox`
    - designed for executing malicious program
    - do not affect the real environment

- Observe the malware behavior
    - communicating IP address
    - process name
    - command executing by malware
    - file change

- Program Breakpoints
- Slow, hard, but more accurate than static analyze

[Back to Table of Content](#table-of-content)

### Open source tools for dynamic analysis
- Any.Run
- VirusTotal
- Cuckoo Sandbox
- Wireshark (monitor network communication of malware)

[Back to Table of Content](#table-of-content)

# Malware Solution
- It can be called antivirus
- Sometimes people mistakenly call `Endpoint Detection and Response (EDR)` as `Antivirus`

[Back to Table of Content](#table-of-content)

## Antivirus
- Detcting malware and take action
    - No-action
    - Remove/Block (Malware is completely remove)
    - Suspend/Quarantine (Malware is not complete remove, require user to action)

- Detect by byte pattern
- Detect by signature
- Detect by behavior
- Commonly work as standalone software
- No need for centralized controls
- Commonly used for individual user/personal user

[Back to Table of Content](#table-of-content)

## Endpoint Detection and Response (EDR)
- May considered as commercial terms for antivirus
- Enable `Antivirus` features
- Can consider as `upgraded antivirus`
- May known as `Endpoint Protection Platform (EPP)`
- May known as `eXtended Endpoint Detection and Response (XDR)` - commercial terms for more advanced EDR
- Detect malware and take action
- Broader range of detection and protection
    - [APT](Chapter2.md/#advanced-persistent-threats-apts)
    - Process monitoring
    - File monitoring
    - Memory monitoring
    - Operating System monitoring
    - Windows API hooking

- May enable [`Data Loss Prevention`](Chapter1.md/#data-loss-prevention-dlp) features
- May utilize machine learning and AI for detection
- May utilize framework such as [MITRE ATT&CK](chapter2.md/#mitre-attck-framework) for better detection
- May enable `backdoor` for administration to solve for malware issue manually
- May send the activities and logs to the centralized system or SIEM
- May alert admins for malicious activities
- May use to communicate between employee and admin
- More expensive than antivirus
- More effective than antivirus
- More proactive than antivirus
- Commonly used in company/enterprise
- Removing EDR may required company consent
    - Cannot easily remove by users or admins
    - Safemode may not disable EDR functions

[Back to Table of Content](#table-of-content)
----------------------------------------------------------------
< [Go to Chapter 2: Cybersecurity Threat Lanscape](Chapter2.md)
<br>
Go to Chapter 4 >